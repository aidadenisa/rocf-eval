(self["webpackChunkrocf_eval"]=self["webpackChunkrocf_eval"]||[]).push([[214],{7734:(t,i,n)=>{"use strict";n.d(i,{Z:()=>o});const e="https://api.rocf.aida.blog",s={post:async(t,i)=>{const n=localStorage.getItem("token")||"";let s=await fetch(e+t,{method:"POST",headers:{"Content-Type":"application/json","x-access-token":n},body:JSON.stringify(i)}).then((t=>t.json()));return s},get:async t=>{const i=localStorage.getItem("token")||"";let n=await fetch(e+t,{method:"GET",crossDomain:!0,headers:{"x-access-token":i}}).then((t=>t.json()));return n},put:async(t,i)=>{const n=localStorage.getItem("token")||"";let s=await fetch(e+t,{method:"PUT",headers:{"Content-Type":"application/json","x-access-token":n},crossDomain:!0,body:JSON.stringify(i)}).then((t=>t.json()));return s},getImage:async t=>{const i=localStorage.getItem("token")||"";let n=await fetch(e+t,{method:"GET",crossDomain:!0,headers:{"x-access-token":i}}),s=await n.blob();return s}},o=s},1390:(t,i,n)=>{"use strict";n.d(i,{Z:()=>l});var e=n(3673),s=n(2323);function o(t,i,n,o,a,r){const h=(0,e.up)("q-icon");return(0,e.wg)(),(0,e.iD)("button",{class:(0,s.C_)(["rocf-button",`variant-${n.variant}`,{"display-block":n.block},`size-${n.size}`])},["left"==n.iconPosition?((0,e.wg)(),(0,e.j4)(h,{key:0,name:n.icon},null,8,["name"])):(0,e.kq)("",!0),(0,e._)("span",null,[(0,e.WI)(t.$slots,"default",{},void 0,!0)]),"right"==n.iconPosition?((0,e.wg)(),(0,e.j4)(h,{key:1,name:n.icon},null,8,["name"])):(0,e.kq)("",!0)],2)}const a={props:{icon:{type:String},iconPosition:{type:String},variant:{type:String,default:"primary"},block:{type:Boolean,default:!0},size:{type:String,default:"large"}}};var r=n(4554),h=n(7518),c=n.n(h);a.render=o,a.__scopeId="data-v-4ab461c7";const l=a;c()(a,"components",{QIcon:r.Z})},3715:(t,i,n)=>{"use strict";n.d(i,{Z:()=>b});n(71);var e=n(3673),s=n(2323);(0,e.dD)("data-v-2a4a6adb");const o={class:"subtitle"},a={class:"title"},r={key:0,class:"info-icon"},h=(0,e.Uk)("Close"),c=["innerHTML"];function l(t,i,n,l,g,d){const u=(0,e.up)("q-icon"),m=(0,e.up)("q-space"),p=(0,e.up)("q-tooltip"),w=(0,e.up)("q-btn"),f=(0,e.up)("q-bar"),v=(0,e.up)("q-card-section"),P=(0,e.up)("q-card"),y=(0,e.up)("q-dialog"),x=(0,e.Q2)("close-popup");return(0,e.wg)(),(0,e.iD)(e.HY,null,[(0,e._)("div",{class:"subpage-heading",onClick:i[0]||(i[0]=(...t)=>d.openInfoDialog&&d.openInfoDialog(...t))},[(0,e._)("div",o,(0,s.zw)(n.subtitle),1),(0,e._)("h2",a,[(0,e.Uk)((0,s.zw)(n.title)+" ",1),n.info?((0,e.wg)(),(0,e.iD)("span",r,[(0,e.Wm)(u,{name:"info"})])):(0,e.kq)("",!0)])]),(0,e.Wm)(y,{modelValue:g.showInfoDialog,"onUpdate:modelValue":i[1]||(i[1]=t=>g.showInfoDialog=t),persistent:""},{default:(0,e.w5)((()=>[(0,e.Wm)(P,null,{default:(0,e.w5)((()=>[(0,e.Wm)(f,null,{default:(0,e.w5)((()=>[(0,e._)("div",null,(0,s.zw)(d.titleTxt),1),(0,e.Wm)(m),(0,e.wy)((0,e.Wm)(w,{dense:"",flat:"",icon:"close"},{default:(0,e.w5)((()=>[(0,e.Wm)(p,{class:"bg-white text-primary"},{default:(0,e.w5)((()=>[h])),_:1})])),_:1},512),[[x]])])),_:1}),(0,e.Wm)(v,null,{default:(0,e.w5)((()=>[(0,e._)("div",{innerHTML:n.info},null,8,c)])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}(0,e.Cn)();const g={props:{subtitle:{type:String},title:{type:String},info:{type:String}},data(){return{showInfoDialog:!1}},methods:{openInfoDialog(){this.info&&(this.showInfoDialog=!0)}},computed:{titleTxt(){return this.$t("subpageHeading_dialogTitle")}}};var d=n(4554),u=n(9815),m=n(151),p=n(846),w=n(2025),f=n(9400),v=n(5528),P=n(5589),y=n(677),x=n(7518),I=n.n(x);g.render=l,g.__scopeId="data-v-2a4a6adb";const b=g;I()(g,"components",{QIcon:d.Z,QDialog:u.Z,QCard:m.Z,QBar:p.Z,QSpace:w.Z,QBtn:f.Z,QTooltip:v.Z,QCardSection:P.Z}),I()(g,"directives",{ClosePopup:y.Z})},1214:(t,i,n)=>{"use strict";n.r(i),n.d(i,{default:()=>Z});n(71);var e=n(3673),s=n(2323),o=n(4850),a=n.n(o);(0,e.dD)("data-v-3717e7d4");const r={class:"points-button-bar flex row justify-end"},h=(0,e._)("img",{src:a()},null,-1),c=[h],l=(0,e._)("div",{class:"canvas-container"},[(0,e._)("canvas",{id:"overlay"})],-1),g=(0,e._)("div",null,"Order of Points",-1),d=(0,e.Uk)("Close"),u=(0,e._)("img",{src:a()},null,-1),m={class:"save-points-btn"};function p(t,i,n,o,a,h){const p=(0,e.up)("subpage-heading"),w=(0,e.up)("rocf-button"),f=(0,e.up)("q-space"),v=(0,e.up)("q-tooltip"),P=(0,e.up)("q-btn"),y=(0,e.up)("q-bar"),x=(0,e.up)("q-card-section"),I=(0,e.up)("q-card"),b=(0,e.up)("q-dialog"),_=(0,e.up)("q-page"),k=(0,e.Q2)("close-popup");return(0,e.wg)(),(0,e.j4)(_,{class:"flex column justify-between"},{default:(0,e.w5)((()=>[(0,e.Wm)(p,{title:h.titleTxt,info:h.infoTxt},null,8,["title","info"]),(0,e._)("div",r,[(0,e._)("div",{class:"example-points col-4",onClick:i[0]||(i[0]=(...t)=>h.zoomPointsImage&&h.zoomPointsImage(...t))},c),(0,e.Wm)(w,{variant:"secondary",class:"reset-points-btn col-4",onClick:h.resetPoints,block:!1},{default:(0,e.w5)((()=>[(0,e.Uk)((0,s.zw)(h.resetTxt),1)])),_:1},8,["onClick"]),(0,e.Wm)(w,{variant:"accent",class:"col-4",icon:"undo",iconPosition:"left",onClick:h.undoPoint,block:!1},{default:(0,e.w5)((()=>[(0,e.Uk)((0,s.zw)(h.undoTxt),1)])),_:1},8,["onClick"])]),l,(0,e.Wm)(b,{modelValue:a.showImageDialog,"onUpdate:modelValue":i[1]||(i[1]=t=>a.showImageDialog=t),persistent:""},{default:(0,e.w5)((()=>[(0,e.Wm)(I,null,{default:(0,e.w5)((()=>[(0,e.Wm)(y,null,{default:(0,e.w5)((()=>[g,(0,e.Wm)(f),(0,e.wy)((0,e.Wm)(P,{dense:"",flat:"",icon:"close"},{default:(0,e.w5)((()=>[(0,e.Wm)(v,{class:"bg-white text-primary"},{default:(0,e.w5)((()=>[d])),_:1})])),_:1},512),[[k]])])),_:1}),(0,e.Wm)(x,null,{default:(0,e.w5)((()=>[u])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,e._)("div",m,[(0,e.Wm)(w,{icon:"chevron_right","icon-position":"right",onClick:h.savePoints},{default:(0,e.w5)((()=>[(0,e.Uk)((0,s.zw)(h.extractTxt),1)])),_:1},8,["onClick"])])])),_:1})}(0,e.Cn)();n(7768);var w=n(7734),f=n(3715),v=n(1390);const P={name:"Camera",components:{SubpageHeading:f.Z,RocfButton:v.Z},data(){return{info:"",cameraOptionsBarHeight:120,imageSrc:"",aspectRatio:1,cropper:{},preview:"",showPoints:!1,zoom:1,canvas:{},baseImage:{},currentPointInOrigin:{},moveStartingPoint:{},dragging:!1,context:{},distance:0,dimensions:{width:0,height:0},radius:20,points:[],result:"",showImageDialog:!1}},beforeMount(){this.imageSrc=this.$store.state.image},mounted(){this.setupCanvas()},methods:{setupCanvas(){this.canvas=document.getElementById("overlay"),this.context=this.canvas.getContext("2d"),this.context.imageSmoothingEnabled=!1,this.baseImage=new Image,this.baseImage.src=this.imageSrc,this.canvas.width=window.screen.width*window.devicePixelRatio,this.canvas.height=.6*window.screen.height*window.devicePixelRatio,console.log("canvas dim: ",this.canvas.width,this.canvas.height),this.aspectRatio=this.canvas.width/this.canvas.height,this.currentPointInOrigin={x:-this.canvas.width/4,y:0},this.canvas.addEventListener("touchstart",this.touchStartHandler),this.canvas.addEventListener("touchmove",this.moveHandler),this.canvas.addEventListener("touchend",this.touchEndHandler),this.baseImage.onload=()=>{this.dimensions={width:1500,height:1e3},this.drawImage()}},touchStartHandler(t){t.preventDefault(),t=t.originalEvent||t,1==t.touches.length?(this.dragging=!0,this.settingPoint=!0,this.zooming=!1,console.log("drag"),this.moveStartingPoint={layerX:t.layerX,layerY:t.layerY}):2==t.touches.length&&(this.zooming=!0,this.dragging=!1,console.log("zoom"),console.log(t),this.distance=this.distanceBetween2Touches(t.touches[0],t.touches[0]))},moveHandler(t){t.preventDefault(),this.settingPoint=!1,console.log("move"),1==t.touches.length&&this.dragging&&this.handleDrag(t),2==t.touches.length&&this.zooming&&this.handleZoom(t),this.drawImage()},touchEndHandler(t){t.preventDefault(),this.zooming=!1,this.dragging=!1,this.settingPoint&&this.setPoint(t)},handleDrag(t){this.currentPointInOrigin.x=this.currentPointInOrigin.x-(this.moveStartingPoint.layerX-t.layerX),this.currentPointInOrigin.y=this.currentPointInOrigin.y-(this.moveStartingPoint.layerY-t.layerY),this.currentPointInOrigin.x=this.currentPointInOrigin.x>0?0:this.currentPointInOrigin.x,this.currentPointInOrigin.x=-this.currentPointInOrigin.x+this.canvas.width>this.dimensions.width?-(this.dimensions.width-this.canvas.width):this.currentPointInOrigin.x,this.currentPointInOrigin.y=this.currentPointInOrigin.y>0?0:this.currentPointInOrigin.y,this.currentPointInOrigin.y=-this.currentPointInOrigin.y+this.canvas.height>this.dimensions.height?-(this.dimensions.height-this.canvas.height):this.currentPointInOrigin.y,this.info=[-this.currentPointInOrigin.x,-this.currentPointInOrigin.y],this.moveStartingPoint={layerX:t.layerX,layerY:t.layerY}},handleZoom(t){let i=this.distanceBetween2Touches(t.touches[0],t.touches[1]);const n=.1;i>this.distance?(console.log("zoom in"),this.zoom+=n):(console.log("zoom out"),this.zoom-=n),this.zoom<1&&(this.zoom=1),this.zoom>4&&(this.zoom=4),this.dimensions={width:1500*this.zoom,height:1e3*this.zoom},this.distance=i},setPoint(t){if(console.log(t),this.points.length>=5)return void alert(this.manyPointsTxt);let i=this.canvas.width/this.canvas.clientWidth,n={x:t.layerX*i,y:t.layerY*i};this.context.beginPath(),this.context.arc(n.x,n.y,this.radius*this.zoom,0,2*Math.PI),this.context.fillStyle="blue",this.context.fill();let e={x:(this.canvas.width*(t.layerX/this.canvas.clientWidth)-this.currentPointInOrigin.x)/this.zoom,y:(this.canvas.height*(t.layerY/this.canvas.clientHeight)-this.currentPointInOrigin.y)/this.zoom};this.info=[e.x,e.y],console.log(e),this.points.push(e)},drawImage(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.drawImage(this.baseImage,this.currentPointInOrigin.x,this.currentPointInOrigin.y,this.dimensions.width,this.dimensions.height),this.drawPoints()},drawPoints(){if(this.points.length)for(let t=0;t<this.points.length;t++){let i={x:this.points[t].x*this.zoom+this.currentPointInOrigin.x,y:this.points[t].y*this.zoom+this.currentPointInOrigin.y};this.context.beginPath(),this.context.arc(i.x,i.y,this.radius*this.zoom,0,2*Math.PI),this.context.fillStyle="blue",this.context.fill()}},resetPoints(){this.points=[],this.drawImage()},distanceBetween2Touches(t,i){return Math.sqrt(Math.pow(t.clientX-i.clientX,2)+Math.pow(t.clientY-i.clientY,2))},savePoints(){5===this.points.length?(this.info="I call this",this.getHomography()):alert(`${this.fewPoints1Txt} ${this.points.length} ${this.fewPoints2Txt}`)},async getHomography(){this.info="this got called";let t={points:[]};for(let s=0;s<this.points.length;s++)t.points.push([this.points[s].x,this.points[s].y]);const i=this.imageSrc.indexOf("data:image/png;base64,");t.imageb64=i>-1?this.imageSrc.slice("data:image/png;base64,".length):this.imageSrc,t.gamma=.7;let n=await w.Z.post("/preprocessing",t);const e=n.image.replaceAll("'","").slice(1);this.result=`data:image/png;base64,${e}`,this.$store.dispatch("fetchPoints",t.points),this.$store.dispatch("fetchGammaImage",this.result),this.$router.push("/evaluate/threshold")},undoPoint(){this.points.pop(),this.drawImage()},zoomPointsImage(){this.showImageDialog=!0}},computed:{titleTxt(){return this.$t("setPoints_title")},infoTxt(){return this.$t("setPoints_info")},resetTxt(){return this.$t("setPoints_reset")},undoTxt(){return this.$t("setPoints_undo")},extractTxt(){return this.$t("setPoints_extract")},fewPoints1Txt(){return this.$t("setPoints_fewPoints1")},fewPoints2Txt(){return this.$t("setPoints_fewPoints2")},manyPointsTxt(){return this.$t("setPoints_manyPoints")}}};var y=n(4379),x=n(9815),I=n(151),b=n(846),_=n(2025),k=n(9400),S=n(5528),z=n(5589),O=n(677),T=n(7518),C=n.n(T);P.render=p,P.__scopeId="data-v-3717e7d4";const Z=P;C()(P,"components",{QPage:y.Z,QDialog:x.Z,QCard:I.Z,QBar:b.Z,QSpace:_.Z,QBtn:k.Z,QTooltip:S.Z,QCardSection:z.Z}),C()(P,"directives",{ClosePopup:O.Z})},4850:(t,i,n)=>{t.exports=n.p+"img/example-points.png"}}]);