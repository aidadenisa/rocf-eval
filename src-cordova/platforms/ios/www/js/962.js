(self["webpackChunkrocf_eval"]=self["webpackChunkrocf_eval"]||[]).push([[962],{7734:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});const s="https://api.rocf2.aida.blog",o={post:async(t,e)=>{const i=localStorage.getItem("token")||"";let o=await fetch(s+t,{method:"POST",headers:{"Content-Type":"application/json","x-access-token":i},body:JSON.stringify(e)}).then((t=>t.json()));return o},get:async t=>{const e=localStorage.getItem("token")||"";let i=await fetch(s+t,{method:"GET",crossDomain:!0,headers:{"x-access-token":e}}).then((t=>t.json()));return i},put:async(t,e)=>{const i=localStorage.getItem("token")||"";let o=await fetch(s+t,{method:"PUT",headers:{"Content-Type":"application/json","x-access-token":i},crossDomain:!0,body:JSON.stringify(e)}).then((t=>t.json()));return o},getImage:async t=>{const e=localStorage.getItem("token")||"";let i=await fetch(s+t,{method:"GET",crossDomain:!0,headers:{"x-access-token":e}}),o=await i.blob();return o}},n=o},4984:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});const s={getDiagnosisFromScore:t=>t<15?"Dementia":t>=15&&t<30?"MCI":t>=30?"Normal":"",getLabelFromScore(t){let e="unknown";switch(t){case 0:e="omitted";break;case 1:e="distorted";break;case 2:e="misplaced";break;case 3:e="correct";break;default:e="unknown"}return e},hasHistory(){return window.history.length>2},sum(t){let e=0;if(!t.length)return e;for(let i=t.length;i--;)e+=t[i];return e}},o=s},2563:(t,e,i)=>{"use strict";i.d(e,{Z:()=>r});var s=i(3673);(0,s.dD)("data-v-62ea849a");const o={class:"g-card"};function n(t,e,i,n,a,r){return(0,s.wg)(),(0,s.iD)("div",o,[(0,s.WI)(t.$slots,"default",{},void 0,!0)])}(0,s.Cn)();const a={};a.render=n,a.__scopeId="data-v-62ea849a";const r=a},8461:(t,e,i)=>{"use strict";i.d(e,{Z:()=>d});var s=i(3673),o=i(2323);(0,s.dD)("data-v-38937d58");const n=["disabled"];function a(t,e,i,a,r,c){const h=(0,s.up)("q-icon");return(0,s.wg)(),(0,s.iD)("button",{class:(0,o.C_)(["rocf-button",`variant-${i.variant}`,{"display-block":i.block},`size-${i.size}`]),disabled:i.disabled},["left"==i.iconPosition?((0,s.wg)(),(0,s.j4)(h,{key:0,name:i.icon},null,8,["name"])):(0,s.kq)("",!0),(0,s._)("span",null,[(0,s.WI)(t.$slots,"default",{},void 0,!0)]),"right"==i.iconPosition?((0,s.wg)(),(0,s.j4)(h,{key:1,name:i.icon},null,8,["name"])):(0,s.kq)("",!0)],10,n)}(0,s.Cn)();const r={props:{icon:{type:String},iconPosition:{type:String},variant:{type:String,default:"primary"},block:{type:Boolean,default:!0},size:{type:String,default:"large"},disabled:{type:Boolean,default:!1}}};var c=i(4554),h=i(7518),l=i.n(h);r.render=a,r.__scopeId="data-v-38937d58";const d=r;l()(r,"components",{QIcon:c.Z})},3715:(t,e,i)=>{"use strict";i.d(e,{Z:()=>b});i(71);var s=i(3673),o=i(2323);(0,s.dD)("data-v-2a4a6adb");const n={class:"subtitle"},a={class:"title"},r={key:0,class:"info-icon"},c=(0,s.Uk)("Close"),h=["innerHTML"];function l(t,e,i,l,d,g){const m=(0,s.up)("q-icon"),u=(0,s.up)("q-space"),p=(0,s.up)("q-tooltip"),v=(0,s.up)("q-btn"),f=(0,s.up)("q-bar"),I=(0,s.up)("q-card-section"),w=(0,s.up)("q-card"),x=(0,s.up)("q-dialog"),R=(0,s.Q2)("close-popup");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s._)("div",{class:"subpage-heading",onClick:e[0]||(e[0]=(...t)=>g.openInfoDialog&&g.openInfoDialog(...t))},[(0,s._)("div",n,(0,o.zw)(i.subtitle),1),(0,s._)("h2",a,[(0,s.Uk)((0,o.zw)(i.title)+" ",1),i.info?((0,s.wg)(),(0,s.iD)("span",r,[(0,s.Wm)(m,{name:"info"})])):(0,s.kq)("",!0)])]),(0,s.Wm)(x,{modelValue:d.showInfoDialog,"onUpdate:modelValue":e[1]||(e[1]=t=>d.showInfoDialog=t),persistent:""},{default:(0,s.w5)((()=>[(0,s.Wm)(w,null,{default:(0,s.w5)((()=>[(0,s.Wm)(f,null,{default:(0,s.w5)((()=>[(0,s._)("div",null,(0,o.zw)(g.titleTxt),1),(0,s.Wm)(u),(0,s.wy)((0,s.Wm)(v,{dense:"",flat:"",icon:"close"},{default:(0,s.w5)((()=>[(0,s.Wm)(p,{class:"bg-white text-primary"},{default:(0,s.w5)((()=>[c])),_:1})])),_:1},512),[[R]])])),_:1}),(0,s.Wm)(I,null,{default:(0,s.w5)((()=>[(0,s._)("div",{innerHTML:i.info},null,8,h)])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}(0,s.Cn)();const d={props:{subtitle:{type:String},title:{type:String},info:{type:String}},data(){return{showInfoDialog:!1}},methods:{openInfoDialog(){this.info&&(this.showInfoDialog=!0)}},computed:{titleTxt(){return this.$t("subpageHeading_dialogTitle")}}};var g=i(4554),m=i(9815),u=i(151),p=i(846),v=i(2025),f=i(9400),I=i(5528),w=i(5589),x=i(677),R=i(7518),P=i.n(R);d.render=l,d.__scopeId="data-v-2a4a6adb";const b=d;P()(d,"components",{QIcon:g.Z,QDialog:m.Z,QCard:u.Z,QBar:p.Z,QSpace:v.Z,QBtn:f.Z,QTooltip:I.Z,QCardSection:w.Z}),P()(d,"directives",{ClosePopup:x.Z})},1962:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>xt});var s=i(3673),o=i(2323),n=i(8880);(0,s.dD)("data-v-b20ac076");const a={class:"total-result"},r={class:"flex row"},c={class:"patient-code col-8"},h={class:"card-title"},l={class:"code"},d={class:"score-box col-4"},g={class:"card-title"},m={class:"score"},u={key:0},p={key:0},v={class:"diagnosis-overridden"},f={key:0,class:"card-title"},I={key:1,class:"card-title"},w={class:"button-bar"},x={key:1,class:"diagnosis-box flex column items-center"},R={class:"card-title"},P={class:"diagnosis-choices"},b={class:"button-bar"},O={class:"section-title"},y={class:"pattern-list"},_={key:0,class:"save-revision"},z={class:"text-h6"};function C(t,e,i,C,D,k){const T=(0,s.up)("subpage-heading"),S=(0,s.up)("rocf-button"),L=(0,s.up)("g-card"),U=(0,s.up)("rocf-pattern"),$=(0,s.up)("q-page-sticky"),M=(0,s.up)("q-space"),q=(0,s.up)("q-btn"),N=(0,s.up)("q-card-section"),W=(0,s.up)("roi-change-modal"),Z=(0,s.up)("q-card-actions"),j=(0,s.up)("q-card"),E=(0,s.up)("q-dialog"),Q=(0,s.up)("q-page"),H=(0,s.Q2)("close-popup");return(0,s.wg)(),(0,s.j4)(Q,{class:(0,o.C_)(["flex","column"])},{default:(0,s.w5)((()=>[(0,s.Wm)(T,{title:k.titleTxt},null,8,["title"]),(0,s._)("div",a,[(0,s.Wm)(L,{class:"result-box flex column"},{default:(0,s.w5)((()=>[(0,s._)("div",r,[(0,s._)("div",c,[(0,s._)("div",h,(0,o.zw)(k.patientCodeTxt),1),(0,s._)("div",l,(0,o.zw)(D.rocf.patientCode),1)]),(0,s._)("div",d,[(0,s._)("div",g,(0,o.zw)(k.scoreTxt),1),(0,s._)("div",m,(0,o.zw)(k.score),1)])]),D.rocf.diagnosis?((0,s.wg)(),(0,s.iD)("div",u,[D.changeDiagnosis?((0,s.wg)(),(0,s.iD)("div",x,[(0,s._)("div",R,(0,o.zw)(k.chooseDiagnosisTxt),1),(0,s._)("div",P,[(0,s._)("div",{class:(0,o.C_)(["normal",{selected:"normal"==D.chosenDiagnosis}]),onClick:e[1]||(e[1]=t=>k.chooseDiagnosis("normal"))},(0,o.zw)(k.normalTxt),3),(0,s._)("div",{class:(0,o.C_)(["mci",{selected:"mci"==D.chosenDiagnosis}]),onClick:e[2]||(e[2]=t=>k.chooseDiagnosis("mci"))},(0,o.zw)(k.mciTxt),3),(0,s._)("div",{class:(0,o.C_)(["dementia",{selected:"dementia"==D.chosenDiagnosis}]),onClick:e[3]||(e[3]=t=>k.chooseDiagnosis("dementia"))},(0,o.zw)(k.dementiaTxt),3)]),(0,s._)("div",b,[(0,s.Wm)(S,{icon:"chevron_left","icon-position":"left",onClick:k.resetDiagnosisChange,block:!1,size:"small",variant:"secondary"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,o.zw)(k.backToPredTxt),1)])),_:1},8,["onClick"])])])):((0,s.wg)(),(0,s.iD)("div",p,[(0,s._)("div",v,[D.rocf.diagnosis.doctorOverridden?((0,s.wg)(),(0,s.iD)("div",f,(0,o.zw)(k.diagnosisTxt),1)):((0,s.wg)(),(0,s.iD)("div",I,(0,o.zw)(k.predictionTxt),1)),(0,s._)("div",{class:(0,o.C_)(["diagnosis-card",D.rocf.diagnosis.labelText])},(0,o.zw)(k.label(D.rocf.diagnosis.labelNumber)),3)]),(0,s._)("div",w,[(0,s.Wm)(S,{icon:"edit","icon-position":"left",variant:"secondary",block:!0,size:"small",onClick:e[0]||(e[0]=t=>D.changeDiagnosis=!0)},{default:(0,s.w5)((()=>[(0,s.Uk)((0,o.zw)(k.changeDiagnosisTxt),1)])),_:1})])]))])):(0,s.kq)("",!0)])),_:1})]),(0,s._)("h3",O,(0,o.zw)(k.patternsTxt),1),(0,s._)("div",y,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(D.rocf.scores,((t,e)=>((0,s.wg)(),(0,s.j4)(U,{key:e,pattern:t,index:e,homographyURL:D.homographyURL,ref:`patternCard${e}`,onNewConfig:k.saveNewScoreForPattern,onOpenModalDrawing:k.openModalWithPattern},null,8,["pattern","index","homographyURL","onNewConfig","onOpenModalDrawing"])))),128))]),D.revised?((0,s.wg)(),(0,s.iD)("div",_,[(0,s.Wm)($,{expand:"",position:"bottom",class:"flex column justify-center"},{default:(0,s.w5)((()=>[(0,s.Wm)(S,{icon:"chevron_right","icon-position":"right",disabled:D.loading,onClick:k.saveRevision},{default:(0,s.w5)((()=>[(0,s.Uk)((0,o.zw)(k.saveRevisionTxt),1)])),_:1},8,["disabled","onClick"])])),_:1})])):(0,s.kq)("",!0),(0,s.Wm)(E,{modelValue:D.zoomImage,"onUpdate:modelValue":e[7]||(e[7]=t=>D.zoomImage=t),"full-height":"","full-width":"",onHide:k.resetDialog},{default:(0,s.w5)((()=>[(0,s.Wm)(j,{class:"column full-height full-width",onClick:e[6]||(e[6]=(0,n.iM)((()=>{}),["stop"]))},{default:(0,s.w5)((()=>[(0,s.Wm)(N,{class:"row items-center q-pb-none"},{default:(0,s.w5)((()=>[(0,s._)("div",z,(0,o.zw)(k.adjustROITxt),1),(0,s.Wm)(M),(0,s.wy)((0,s.Wm)(q,{icon:"close",flat:"",round:"",dense:""},null,512),[[H]])])),_:1}),(0,s.Wm)(N,{class:"image-canvas col q-pt-none scroll"},{default:(0,s.w5)((()=>[(0,s.Wm)(W,{zoomImageURL:D.zoomImageURL,zoomROI:D.zoomROI,changeROI:D.changeROI,onRoiChanged:k.saveROIChange},null,8,["zoomImageURL","zoomROI","changeROI","onRoiChanged"])])),_:1}),(0,s.Wm)(Z,{align:"right",class:"bg-white text-teal",onClick:e[5]||(e[5]=(0,n.iM)((()=>{}),["stop"]))},{default:(0,s.w5)((()=>[D.zoomROI.length||D.changeROI?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(S,{key:0,icon:"edit","icon-position":"left",variant:"accent",onClick:(0,n.iM)(k.addNewROI,["prevent"])},{default:(0,s.w5)((()=>[(0,s.Uk)((0,o.zw)(k.addNewROITxt),1)])),_:1},8,["onClick"])),D.zoomROI.length&&!D.changeROI?((0,s.wg)(),(0,s.j4)(S,{key:1,icon:"edit","icon-position":"left",variant:"accent",onClick:(0,n.iM)(k.setupChangeROI,["prevent"])},{default:(0,s.w5)((()=>[(0,s.Uk)((0,o.zw)(k.changeROITxt),1)])),_:1},8,["onClick"])):(0,s.kq)("",!0),D.zoomROI.length&&D.changeROI?((0,s.wg)(),(0,s.j4)(S,{key:2,onClick:e[4]||(e[4]=(0,n.iM)((t=>D.changeROI=!1),["prevent"]))},{default:(0,s.w5)((()=>[(0,s.Uk)((0,o.zw)(k.saveROITxt),1)])),_:1})):(0,s.kq)("",!0)])),_:1})])),_:1})])),_:1},8,["modelValue","onHide"])])),_:1})}(0,s.Cn)();i(71),i(7965),i(6016);var D=i(3715);(0,s.dD)("data-v-04541aee");const k={class:"rocf-pattern-card"},T={class:"heading flex justify-between"},S={class:"title"},L={class:"content"},U={class:"roi-visualization"},$={class:"original"},M=["src"],q={class:"pattern-found"},N={class:"score-box"},W={class:"section-title"},Z={key:0,class:"edit-mode-labels flex row "},j=["onClick"];function E(t,e,i,a,r,c){const h=(0,s.up)("q-icon"),l=(0,s.up)("roi-visualization"),d=(0,s.up)("q-slider"),g=(0,s.up)("g-card");return(0,s.wg)(),(0,s.iD)("div",k,[(0,s.Wm)(g,{class:"pattern-box"},{default:(0,s.w5)((()=>[(0,s._)("div",T,[(0,s._)("div",S,(0,o.zw)(c.patternTxt)+" "+(0,o.zw)(c.indexPretty),1),(0,s._)("div",{class:(0,o.C_)(["label","label-"+r.revisedPattern.chosenLabel]),onClick:e[0]||(e[0]=(0,n.iM)(((...t)=>c.toggleEditMode&&c.toggleEditMode(...t)),["prevent"]))},[(0,s.Wm)(h,{name:"edit",class:"edit-icon"}),(0,s.Uk)(" "+(0,o.zw)(r.revisedPattern.chosenLabel),1)],2)]),(0,s._)("div",L,[(0,s._)("div",U,[(0,s._)("div",$,[(0,s._)("img",{src:c.originalPatternURL},null,8,M)]),(0,s._)("div",q,[r.revisedPattern.chosenROI?((0,s.wg)(),(0,s.j4)(l,{key:0,roi:r.revisedPattern.chosenROI,homographyURL:i.homographyURL,onClickOnCanvas:c.openROIChangeModal},null,8,["roi","homographyURL","onClickOnCanvas"])):(0,s.kq)("",!0)])]),(0,s._)("div",{class:"label-box",onClick:e[1]||(e[1]=(0,n.iM)(((...t)=>c.toggleEditMode&&c.toggleEditMode(...t)),["prevent"]))},[(0,s.Uk)((0,o.zw)(c.patternIsTxt)+" ",1),(0,s._)("span",{class:(0,o.C_)(["label","label-"+r.revisedPattern.chosenLabel])},[(0,s.Uk)((0,o.zw)(r.revisedPattern.chosenLabel)+" ",1),(0,s.Wm)(h,{name:"edit",class:"edit-icon"})],2)]),(0,s._)("div",N,[(0,s._)("div",W,(0,o.zw)(c.scoreTxt)+":",1),(0,s.Wm)(d,{modelValue:r.revisedPattern.chosenScore,"onUpdate:modelValue":e[2]||(e[2]=t=>r.revisedPattern.chosenScore=t),min:0,max:2,step:.5,"track-size":"10px","thumb-size":"35px",snap:"",label:"","label-always":"",color:"primary",onChange:c.setChosenScore},null,8,["modelValue","step","onChange"]),r.editMode?((0,s.wg)(),(0,s.iD)("div",Z,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.labels,((t,e)=>((0,s.wg)(),(0,s.iD)("div",{key:e,class:(0,o.C_)(["new-label","label-"+t]),onClick:t=>c.setChosenLabel(e)},(0,o.zw)(t),11,j)))),128))])):(0,s.kq)("",!0)])])])),_:1})])}(0,s.Cn)();var Q=i(4984),H=i(2563);(0,s.dD)("data-v-02488a7c");const F={class:"roi-canvas"},B=["src"];function A(t,e,i,o,n,a){return(0,s.wg)(),(0,s.iD)("div",F,[(0,s._)("img",{src:i.homographyURL,ref:"drawing",class:"drawing-image"},null,8,B),(0,s._)("canvas",{ref:"roi",onClick:e[0]||(e[0]=e=>t.$emit("click-on-canvas",i.roi))},null,512)])}(0,s.Cn)();var V=i(7734);const Y={data(){return{image_original:"../assets/img/ROCF_original.png",canvas:{},context:{},baseImage:null,ratio:1}},props:{roi:{type:Array},homographyURL:{type:String}},methods:{setupCanvas(){this.canvas=this.$el.querySelector(".roi-canvas canvas"),this.context=this.canvas.getContext("2d"),this.context.imageSmoothingEnabled=!1,this.baseImage=new Image,this.baseImage.src=this.homographyURL,this.canvas.width=this.$el.querySelector("img.drawing-image").width*window.devicePixelRatio,this.canvas.height=this.$el.querySelector("img.drawing-image").height*window.devicePixelRatio,this.ratio=this.canvas.width/this.baseImage.width,this.drawImage()},drawImage(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);for(let t=0;t<this.roi.length;t++){this.context.strokeStyle="#f00",this.context.beginPath(),this.context.moveTo(this.roi[t][0][0]*this.ratio,this.roi[t][0][1]*this.ratio);for(let e=1;e<this.roi[t].length;e++)this.context.lineTo(this.roi[t][e][0]*this.ratio,this.roi[t][e][1]*this.ratio);this.context.closePath(),this.context.lineWidth=3,this.context.stroke()}}},beforeMount(){console.log("beforeMount")},mounted(){console.log("mounted"),this.homographyURL&&this.setupCanvas()},watch:{homographyURL(){setTimeout((()=>{this.setupCanvas()}),500)},roi(){this.drawImage()}}};Y.render=A,Y.__scopeId="data-v-02488a7c";const X=Y,G={props:{pattern:{type:Object},index:{type:Number},homographyURL:{type:String}},data(){return{scorePretty:0,editMode:!1,labels:["omitted","distorted","misplaced","correct"],chosenLabel:"",chosenLabelNumber:0,revisedPattern:{chosenScore:0,chosenLabel:"omitted",chosenLabelNumber:0,chosenROI:[]}}},components:{GCard:H.Z,RoiVisualization:X},methods:{setRevisedPattern(){this.revisedPattern={chosenScore:this.pattern.score,chosenLabel:this.pattern.label,chosenLabelNumber:this.pattern.labelNumber,chosenROI:this.pattern.roi}},toggleEditMode(){this.editMode=!this.editMode,setTimeout((()=>{this.editMode&&this.$el.querySelector(".edit-mode-labels").scrollIntoView({block:"center"})}),100)},setChosenLabel(t){this.revisedPattern.chosenLabel=this.labels[t],this.revisedPattern.chosenLabelNumber=t,this.toggleEditMode(),this.$emit("newConfig",this.index,this.revisedPattern)},handleNewROI(t,e){e==this.index&&(this.revisedPattern.chosenROI=t,this.revisedPattern=JSON.parse(JSON.stringify(this.revisedPattern)),this.$emit("newConfig",this.index,this.revisedPattern))},openROIChangeModal(t){this.$emit("open-modal-drawing",t,this.homographyURL,this.index)},setChosenScore(){this.editMode=!0,this.$emit("newConfig",this.index,this.revisedPattern)}},beforeMount(){this.setRevisedPattern()},computed:{indexPretty(){return this.index+1},label(){return Q.Z.getLabelFromScore(this.pattern)},originalPatternURL(){return i(4146)(`./P${this.index+1}.png`)},patternTxt(){return this.$t("rocfPattern_pattern")},patternIsTxt(){return this.$t("rocfPattern_patternIs")},scoreTxt(){return this.$t("rocfPattern_score")}}};var J=i(4554),K=i(3872),tt=i(7518),et=i.n(tt);G.render=E,G.__scopeId="data-v-04541aee";const it=G;et()(G,"components",{QIcon:J.Z,QSlider:K.Z});var st=i(8461);(0,s.dD)("data-v-37831563");const ot={class:"canvas-container"},nt=(0,s._)("canvas",{id:"roi-canvas"},null,-1),at=[nt];function rt(t,e,i,o,n,a){return(0,s.wg)(),(0,s.iD)("div",ot,at)}(0,s.Cn)();const ct={props:{zoomROI:{type:Array,default:()=>[]},zoomImageURL:{type:String,default:""},changeROI:{type:Boolean,default:!1}},data(){return{info:"",cameraOptionsBarHeight:120,imageSrc:"",aspectRatio:1,cropper:{},preview:"",showPoints:!1,zoom:2,canvas:{},baseImage:{},currentPointInOrigin:{},moveStartingPoint:{},dragging:!1,context:{},distance:0,dimensions:{width:0,height:0},radius:20,points:[],result:"",draggingPoints:[],selectedCorner:{min_index:null,min_point:null}}},methods:{setupCanvas(){this.canvas=document.getElementById("roi-canvas"),this.context=this.canvas.getContext("2d"),this.context.imageSmoothingEnabled=!1,this.baseImage=new Image,this.baseImage.src=this.zoomImageURL,this.canvas.addEventListener("touchstart",this.touchStartHandler),this.canvas.addEventListener("touchmove",this.moveHandler),this.canvas.addEventListener("touchend",this.touchEndHandler),this.baseImage.onload=()=>{this.canvas.width=window.screen.width*window.devicePixelRatio,this.canvas.height=Math.min(this.baseImage.height,.9*window.screen.height)*window.devicePixelRatio,this.currentPointInOrigin={x:-this.canvas.width/4,y:0},console.log("canvas dim: ",this.canvas.width,this.canvas.height),this.aspectRatio=this.canvas.width/this.canvas.height,this.dimensions={width:this.baseImage.width*this.zoom,height:this.baseImage.height*this.zoom},this.drawImage(),this.drawROI()}},drawImage(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.drawImage(this.baseImage,this.currentPointInOrigin.x,this.currentPointInOrigin.y,this.dimensions.width,this.dimensions.height)},drawROI(){for(let t=0;t<this.zoomROI.length;t++){const e={x:this.zoomROI[t][0][0]*this.zoom+this.currentPointInOrigin.x,y:this.zoomROI[t][0][1]*this.zoom+this.currentPointInOrigin.y};this.context.strokeStyle="#f00",this.context.beginPath(),this.context.moveTo(e.x,e.y);for(let i=1;i<this.zoomROI[t].length;i++){const e={x:this.zoomROI[t][i][0]*this.zoom+this.currentPointInOrigin.x,y:this.zoomROI[t][i][1]*this.zoom+this.currentPointInOrigin.y};this.context.lineTo(e.x,e.y)}this.context.closePath(),this.context.lineWidth=3*this.zoom,this.context.stroke()}},touchStartHandler(t){if(t.preventDefault(),t=t.originalEvent||t,1==t.touches.length&&(this.dragging=!0,this.zooming=!1,console.log("drag"),this.moveStartingPoint={layerX:t.layerX,layerY:t.layerY},this.changeROI)){const e=this.getSelectedCorner(t);this.selectedCorner=e}},moveHandler(t){t.preventDefault(),this.settingPoint=!1,console.log("move"),1==t.touches.length&&this.dragging&&(this.changeROI&&null!==this.selectedCorner.min_point?this.dragCorner(t,this.selectedCorner):this.handleDrag(t)),this.drawImage(),this.changeROI?this.drawDraggingPoints():this.drawROI()},touchEndHandler(t){t.preventDefault(),this.dragging=!1,this.selectedCorner=null},handleDrag(t){this.currentPointInOrigin.x=this.currentPointInOrigin.x-(this.moveStartingPoint.layerX-t.layerX),this.currentPointInOrigin.y=this.currentPointInOrigin.y-(this.moveStartingPoint.layerY-t.layerY),this.currentPointInOrigin.x=this.currentPointInOrigin.x>0?0:this.currentPointInOrigin.x,this.currentPointInOrigin.x=-this.currentPointInOrigin.x+this.canvas.width>this.dimensions.width?-(this.dimensions.width-this.canvas.width):this.currentPointInOrigin.x,this.currentPointInOrigin.y=this.currentPointInOrigin.y>0?0:this.currentPointInOrigin.y,this.currentPointInOrigin.y=-this.currentPointInOrigin.y+this.canvas.height>this.dimensions.height?-(this.dimensions.height-this.canvas.height):this.currentPointInOrigin.y,this.info=[-this.currentPointInOrigin.x,-this.currentPointInOrigin.y],this.moveStartingPoint={layerX:t.layerX,layerY:t.layerY}},drawDraggingPoints(){this.drawImage();for(let t=0;t<this.draggingPoints.length;t++){const e={x:this.draggingPoints[t][0][0]*this.zoom+this.currentPointInOrigin.x,y:this.draggingPoints[t][0][1]*this.zoom+this.currentPointInOrigin.y};this.context.strokeStyle="#f00",this.context.beginPath(),this.context.moveTo(e.x,e.y);for(let i=1;i<this.draggingPoints[t].length;i++){const e={x:this.draggingPoints[t][i][0]*this.zoom+this.currentPointInOrigin.x,y:this.draggingPoints[t][i][1]*this.zoom+this.currentPointInOrigin.y};this.context.lineTo(e.x,e.y)}this.context.closePath(),this.context.lineWidth=3*this.zoom,this.context.stroke();for(let i=0;i<this.draggingPoints[t].length;i++){const e={x:this.draggingPoints[t][i][0]*this.zoom+this.currentPointInOrigin.x,y:this.draggingPoints[t][i][1]*this.zoom+this.currentPointInOrigin.y};this.context.beginPath(),this.context.arc(e.x,e.y,this.radius*this.zoom,0,2*Math.PI),this.context.fillStyle="blue",this.context.fill()}}},getSelectedCorner(t){t.preventDefault();const e={x:-this.currentPointInOrigin.x/this.zoom+t.pageX,y:-this.currentPointInOrigin.y/this.zoom+t.pageY};let i=9999,s=null,o=null;for(let n=0;n<this.draggingPoints.length;n++)for(let t=0;t<this.draggingPoints[n].length;t++){const a=Math.sqrt(Math.pow(e.x-this.draggingPoints[n][t][0],2)+Math.pow(e.y-this.draggingPoints[n][t][1],2));a<this.radius*this.zoom+10*this.zoom&&a<i&&(i=a,s=t,o=n)}return{min_point:s,min_index:o}},dragCorner(t,e){t.preventDefault(),this.draggingPoints[e.min_index][e.min_point][0]=-this.currentPointInOrigin.x/this.zoom+t.pageX,this.draggingPoints[e.min_index][e.min_point][1]=-this.currentPointInOrigin.y/this.zoom+t.pageY},calcPolygonArea(t){for(var e=0,i=0,s=t.length;i<s;i++){var o=t[i][0],n=t[i==t.length-1?0:i+1][1],a=t[i==t.length-1?0:i+1][0],r=t[i][1];e+=o*n*.5,e-=a*r*.5}return Math.abs(e)}},mounted(){console.log("mounted"),this.zoomImageURL&&this.setupCanvas()},watch:{zoomImageURL(){setTimeout((()=>{this.setupCanvas()}),500)},zoomROI(){this.setupCanvas()},changeROI(t){if(t){let t=[];for(let e=0;e<this.zoomROI.length;e++)if(4==this.zoomROI[e].length)t.push(this.zoomROI[e]);else if(6==this.zoomROI[e].length){let i=99999,s=null,o=null,n=0;for(let t=1;t<this.zoomROI[e].length-1;t++){const a=this.zoomROI[e][n],r=this.zoomROI[e][t],c=Math.sqrt(Math.pow(a[0]-r[0],2)+Math.pow(a[1]-r[1],2));c<i&&(i=c,s=n,o=t),n+=1}let a=[...this.zoomROI[e]];a.pop();let r=a.filter(((t,e)=>e!=s));const c=this.calcPolygonArea(r);let h=a.filter(((t,e)=>e!=o));const l=this.calcPolygonArea(h);c>l?t.push(h):t.push(r)}else{let i=99999,s=99999,o=0,n=0;for(let t=0;t<this.zoomROI[e].length;t++)this.zoomROI[e][t][0]<i&&(i=this.zoomROI[e][t][0]),this.zoomROI[e][t][0]>o&&(o=this.zoomROI[e][t][0]),this.zoomROI[e][t][1]<s&&(s=this.zoomROI[e][t][1]),this.zoomROI[e][t][1]>n&&(n=this.zoomROI[e][t][1]);t.push([[i,s],[o,s],[o,n],[i,n]])}this.draggingPoints=t,this.drawDraggingPoints()}else this.$emit("roi-changed",this.draggingPoints),this.draggingPoints=[],this.selectedCorner=null,this.drawImage(),this.drawROI()}}};ct.render=rt,ct.__scopeId="data-v-37831563";const ht=ct,lt={components:{RocfPattern:it,SubpageHeading:D.Z,GCard:H.Z,RocfButton:st.Z,RoiChangeModal:ht},data(){return{rocf:null,info:"",revised:!1,labels:["omitted","distorted","misplaced","correct"],showSaveDialog:!1,homographyURL:"",showOriginal:!1,changeDiagnosis:!1,chosenDiagnosis:"",zoomImage:!1,zoomImageURL:"",zoomROI:[],zoomPatternIndex:null,changeROI:!1,loading:!1}},methods:{async getThreshedImage(){let t=await V.Z.getImage(`/files/${this.docID}/${this.activeImgFolder}/${this.rocf.imageName}.png`),e=new Image;e.onload=()=>{this.homographyURL=window.URL.createObjectURL(t)},e.src=window.URL.createObjectURL(t)},saveNewScoreForPattern(t,e){this.rocf.revisedScores[t].revisedScore=e.chosenScore,this.rocf.revisedScores[t].revisedLabel=e.chosenLabel,this.rocf.revisedScores[t].revisedROI=e.chosenROI,this.revised=!0},createCloneOfScores(){let t=[];for(let e=0;e<this.rocf.scores.length;e++)t.push({initialScore:this.rocf.scores[e].score,initialLabel:this.rocf.scores[e].label,initialROI:this.rocf.scores[e].roi,revisedScore:this.rocf.scores[e].score,revisedLabel:this.rocf.scores[e].label,revisedROI:this.rocf.scores[e].roi});return t},createCloneOfDiagnosis(){let t={initialDiagnosisNumber:this.rocf.diagnosis.labelNumber,initialDiagnosisText:this.rocf.diagnosis.labelText,revisedDiagnosisNumber:this.rocf.diagnosis.labelNumber,revisedDiagnosisText:this.rocf.diagnosis.labelText};return t},updateScoresAfterRevision(){for(let t=0;t<this.rocf.scores.length;t++)this.rocf.scores[t].score=this.rocf.revisedScores[t].revisedScore,this.rocf.scores[t].label=this.rocf.revisedScores[t].revisedLabel,this.rocf.scores[t].labelNumber=this.labels.indexOf(this.rocf.revisedScores[t].revisedLabel)},updateDiagnosisAfterRevision(){this.rocf.diagnosis.labelNumber=this.rocf.revisedDiagnosis.revisedDiagnosisNumber,this.rocf.diagnosis.labelText=this.rocf.revisedDiagnosis.revisedDiagnosisText,this.rocf.diagnosis.doctorOverridden=this.rocf.revisedDiagnosis.revisedDoctorOverridden},updateROIsAfterRevision(){for(let t=0;t<this.rocf.scores.length;t++)this.rocf.scores[t].roi=this.rocf.revisedScores[t].revisedROI},async saveRevision(){this.loading=!0,this.rocf["_rocfEvaluationId"]=this.rocf._id,this.updateScoresAfterRevision(),this.updateDiagnosisAfterRevision(),this.updateROIsAfterRevision();let t=await V.Z.post("/revision",this.rocf).catch((t=>{console.log(t),alert(this.errorTxt),this.loading=!1}));this.loading=!1,console.log(t),alert(this.savedTxt),this.revised=!1,this.changeDiagnosis=!1},label(t){return 0==t?"Normal":1==t?"MCI":"Dementia"},getNumberFromLabel(t){return"normal"==t.toLowerCase()?0:"mci"==t.toLowerCase()?1:2},setWidthFromProbability(t){let e=100*parseFloat(t).toFixed(2);return e+"%"},chooseDiagnosis(t){this.revised=!0,this.chosenDiagnosis=t,this.rocf.revisedDiagnosis.revisedDiagnosisNumber=this.getNumberFromLabel(this.chosenDiagnosis),this.rocf.revisedDiagnosis.revisedDiagnosisText=this.chosenDiagnosis,this.rocf.revisedDiagnosis.revisedDoctorOverridden=!0},resetDiagnosisChange(){this.changeDiagnosis=!1,this.chosenDiagnosis="",this.rocf.revisedDiagnosis=this.createCloneOfDiagnosis()},openModalWithPattern(t,e,i){this.zoomImage=!0,this.zoomImageURL=e,this.zoomROI=t,this.zoomPatternIndex=i},setupChangeROI(){this.changeROI=!0},saveROIChange(t){this.$refs[`patternCard${this.zoomPatternIndex}`].handleNewROI(t,this.zoomPatternIndex),this.resetDialog(),this.revised=!0},resetDialog(){this.zoomImage=!1,this.zoomImageURL="",this.zoomROI=[],this.zoomPatternIndex=null,this.changeROI=!1},addNewROI(){this.zoomROI=[[[300,200],[800,200],[800,600],[300,600]]],this.changeROI=!0}},async beforeMount(){this.rocf=this.$store.getters.getROCF(this.$route.params.id),this.rocf.revisedScores=this.createCloneOfScores(),this.rocf.revisedDiagnosis=this.createCloneOfDiagnosis(),await this.getThreshedImage()},beforeRouteLeave(t,e,i){this.revised&&!confirm(this.alertTxt)?i(!1):i()},watch:{async activeImgFolder(){await this.getThreshedImage()}},computed:{score(){return this.rocf.scores?Q.Z.sum(this.rocf.scores.map((t=>t.score))):0},activeImgFolder(){return this.showOriginal?"original":"threshed"},docID(){return this.$store.state.user.id},titleTxt(){return this.$t("rocfResult_title")},patientCodeTxt(){return this.$t("rocfResult_patientCode")},scoreTxt(){return this.$t("rocfResult_score")},diagnosisTxt(){return this.$t("rocfResult_diagnosis")},predictionTxt(){return this.$t("rocfResult_prediction")},changeDiagnosisTxt(){return this.$t("rocfResult_changeDiagBtn")},chooseDiagnosisTxt(){return this.$t("rocfResult_chooseDiagBtn")},normalTxt(){return this.$t("rocfResult_normal")},mciTxt(){return this.$t("rocfResult_mci")},dementiaTxt(){return this.$t("rocfResult_dementia")},backToPredTxt(){return this.$t("rocfResult_backToPredBtn")},patternsTxt(){return this.$t("rocfResult_patterns")},saveRevisionTxt(){return this.$t("rocfResult_saveRevisionBtn")},adjustROITxt(){return this.$t("rocfResult_adjustRegion")},changeROITxt(){return this.$t("rocfResult_changeRegion")},saveROITxt(){return this.$t("rocfResult_saveRegion")},savedTxt(){return this.$t("rocfResult_saved")},addNewROITxt(){return this.$t("rocfResult_newROI")},errorTxt(){return this.$t("rocfResult_saveError")},alertTxt(){return this.$t("rocfResult_alertExit")}}};var dt=i(4379),gt=i(1007),mt=i(9815),ut=i(151),pt=i(5589),vt=i(2025),ft=i(9400),It=i(9367),wt=i(677);lt.render=C,lt.__scopeId="data-v-b20ac076";const xt=lt;et()(lt,"components",{QPage:dt.Z,QPageSticky:gt.Z,QDialog:mt.Z,QCard:ut.Z,QCardSection:pt.Z,QSpace:vt.Z,QBtn:ft.Z,QCardActions:It.Z}),et()(lt,"directives",{ClosePopup:wt.Z})},5633:(t,e,i)=>{t.exports=i.p+"img/P1.png"},582:(t,e,i)=>{t.exports=i.p+"img/P10.png"},4977:(t,e,i)=>{t.exports=i.p+"img/P11.png"},8415:(t,e,i)=>{t.exports=i.p+"img/P12.png"},5169:(t,e,i)=>{t.exports=i.p+"img/P13.png"},2600:(t,e,i)=>{t.exports=i.p+"img/P14.png"},7917:(t,e,i)=>{t.exports=i.p+"img/P15.png"},6441:(t,e,i)=>{t.exports=i.p+"img/P16.png"},8590:(t,e,i)=>{t.exports=i.p+"img/P17.png"},9373:(t,e,i)=>{t.exports=i.p+"img/P18.png"},619:(t,e,i)=>{t.exports=i.p+"img/P2.png"},4514:(t,e,i)=>{t.exports=i.p+"img/P3.png"},6061:(t,e,i)=>{t.exports=i.p+"img/P4.png"},82:(t,e,i)=>{t.exports=i.p+"img/P5.png"},4856:(t,e,i)=>{t.exports=i.p+"img/P6.png"},2504:(t,e,i)=>{t.exports=i.p+"img/P7.png"},4830:(t,e,i)=>{t.exports=i.p+"img/P8.png"},9707:(t,e,i)=>{t.exports=i.p+"img/P9.png"},4146:(t,e,i)=>{var s={"./P1.png":5633,"./P10.png":582,"./P11.png":4977,"./P12.png":8415,"./P13.png":5169,"./P14.png":2600,"./P15.png":7917,"./P16.png":6441,"./P17.png":8590,"./P18.png":9373,"./P2.png":619,"./P3.png":4514,"./P4.png":6061,"./P5.png":82,"./P6.png":4856,"./P7.png":2504,"./P8.png":4830,"./P9.png":9707};function o(t){var e=n(t);return i(e)}function n(t){if(!i.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}o.keys=function(){return Object.keys(s)},o.resolve=n,t.exports=o,o.id=4146}}]);